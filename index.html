<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>

    <style type="text/css">

    </style>
</head>
<body>


<script>
    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
            default: 'arcade',
            arcade: {
                // gravity: { y: 300 },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };


    let game = new Phaser.Game(config);
    let player;
    let enemy;
    let cursors;
    let virus;
    let score = 0;


    function preload ()
    {
        this.load.image('bg', "assets/img/sky.png");
        this.load.image('virus', 'assets/img/coronavirus_spine/images/classic/body.png');
        this.load.spritesheet('player',
            'assets/img/dude.png',
            { frameWidth: 32, frameHeight: 48 }
        );
        this.load.spritesheet('enemy',
            'assets/img/dude.png',
            { frameWidth: 32, frameHeight: 48 }
        );
    }

    function create ()
    {
        this.add.image(400, 300, 'bg');
        player = this.physics.add.sprite(100, 300, 'player');
        // player.setBounce(0.5);
        player.setCollideWorldBounds(true);


        // ENEMY
        enemy = this.physics.add.sprite(350, 350, 'enemy');
        enemy.setCollideWorldBounds(true);
        enemy.setTint(0xff0000);

        function generateEnemies(enemy){
            // generate more enemies with time
        }

        virus = this.physics.add.group();
        function hitVirus (player, virus) {
            this.physics.pause();

            player.setTint(0xff0000);

            player.anims.play('turn');

            gameOver = true;
        }
        this.physics.add.collider(player, virus, hitVirus, null, this);
        this.physics.moveToObject(enemy, player, 60, 9000);
        this.physics.add.collider(player, enemy, hitVirus, null, this);

        scoreText = this.add.text(16, 16, 'points: 0', { fontSize: '24px', fill: '#662994' });


        // player movement
        this.anims.create({
            key: 'left',
            frames: this.anims.generateFrameNumbers('player', { start: 0, end: 3 }),
            frameRate: 10,
            repeat: -1
        });

        this.anims.create({
            key: 'turn',
            frames: [ { key: 'player', frame: 4 } ],
            frameRate: 20
        });

        this.anims.create({
            key: 'right',
            frames: this.anims.generateFrameNumbers('player', { start: 5, end: 8 }),
            frameRate: 10,
            repeat: -1
        });
    }

    function update () {
        cursors = this.input.keyboard.createCursorKeys();
        this.physics.moveToObject(enemy, player, 60, 9000);

        player.setVelocity(0, 0);

        if (cursors.left.isDown)
        {
            player.setVelocityX(-200);

            player.anims.play('left', true);
        }
        else if (cursors.right.isDown)
        {
            player.setVelocityX(200);

            player.anims.play('right', true);
        }
        else if (cursors.up.isDown)
        {
            player.setVelocityY(-200);
        }
        else if (cursors.down.isDown)
        {
            player.setVelocityY(200);
        }
        else
        {
            player.anims.play('left', false);
            player.anims.play('right', false);
            player.anims.play('turn');
        }
    }


    /*TODO
    * generate enemies
    * enemy follow player
    * game over if gets hit 3X
    * score increase if collects tp
    * add space vertically where player can walk
    *
    *
    * probs
    * enemy only following to original point
    * */
</script>

</body>
</html>
